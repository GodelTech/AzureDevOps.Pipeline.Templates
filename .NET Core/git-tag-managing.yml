parameters:
  isDefaultBranch: false
  shouldCreateNewTag: false
  tempParam: false

steps:
- task: PowerShell@2
  #condition: eq(${{ parameters.isDefaultBranch }}, true)
  condition: eq($(git describe --tags --abbrev=0), '3.0.2')
  displayName: 'Compare last tag with build number'
  inputs:
    targetType: "inline"
    script:
      $lastTag = $(git describe --tags --abbrev=0);
      $shouldCreateNewTag = $($lastTag -ne $Build.BuildNumber);
      Write-Host "##vso[task.setvariable variable=shouldCreateNewTag]$shouldCreateNewTag";
      Write-Host "##vso[task.setvariable variable=tempParam]true";
      Write-Host "New Build Version:" ${{ parameters.shouldCreateNewTag }};
      Write-Host "isDefaultBranch:" variables.isDefaultBranch;

- task: git-tag-on-release-task@9
  condition: and(succeeded(), eq(${{ parameters.isDefaultBranch }}, true), eq(${{ parameters.shouldCreateNewTag }}, true))
  displayName: 'Add new tag to git'
  inputs:
    staticTagName: '$(Build.BuildNumber)'